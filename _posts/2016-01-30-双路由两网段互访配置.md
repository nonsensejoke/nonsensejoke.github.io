---
layout: default
title: "双路由两网段互访配置"
date: 2026-01-30
categories: [networking, routing]
tags: [static-route, nat, lan, subnet]
---

## 问题描述

网络拓扑如下：

- 路由器1（Router1）LAN 口连接：PC-A、PC-B、路由器2（Router2）
- 路由器2（Router2）LAN 口连接：PC-C、PC-D

已知地址信息：

- Router1 网关地址：`192.168.1.254`
- Router2 网关地址：`192.168.0.1`
- Router2 在 Router1 中绑定（或获取）的地址：`192.168.1.100`

目标：让 **所有 PC（A / B / C / D）可以自由互访**（跨网段互通）。

---

## 现状与关键点

当前网络是两个不同网段：

- 网段1：`192.168.1.0/24`（PC-A、PC-B、Router1）
- 网段2：`192.168.0.0/24`（PC-C、PC-D、Router2 LAN）

想让两个网段互访，需要满足：

1. Router1 **知道如何到达** `192.168.0.0/24`
2. Router2 能在两个网段之间 **做纯路由转发**（不要用 NAT 把路由逻辑“遮住”）
3. 各 PC 的默认网关设置正确

---

## 最终工作配置（推荐结构）

```
                192.168.1.0/24
 PC-A/PC-B  ───────── Router1 (192.168.1.254)
                            |
                            |  (上行到 Router2)
                            |
                    Router2 WAN/上行：192.168.1.100
                    Router2 LAN：      192.168.0.1
                            |
                192.168.0.0/24
                     PC-C / PC-D
```

---

## 配置步骤

### 1) Router2：确认上行口在 192.168.1.0/24

确保 Router2 连接 Router1 的“上行接口”（WAN 或上行口）使用：

- 上行口 IP：`192.168.1.100`
- 子网掩码：`255.255.255.0`
- 默认网关：`192.168.1.254`（Router1）

> 这一步的目的：让 Router2 能把去往 `192.168.1.0/24` 或更外侧的流量交给 Router1。

---

### 2) Router1：添加静态路由（关键）

在 Router1 的“静态路由（Static Route）”里添加一条路由规则：

- 目标网络（Destination Network）：`192.168.0.0`
- 子网掩码（Subnet Mask）：`255.255.255.0`
- 下一跳/网关（Gateway / Next Hop）：`192.168.1.100`

含义是：

> Router1 看到目标为 `192.168.0.x` 的流量时，转发给 Router2（`192.168.1.100`）处理。

---

### 3) Router2：关闭 NAT（让它做“纯路由”）

在 Router2 中关闭 NAT（或切换为 Routing Only / Disable NAT）。

为什么要关 NAT？

- 你的需求是 **内网与内网跨网段互访**（`192.168.1.0/24` ↔ `192.168.0.0/24`）
- NAT 更适合“私网共享公网”的上网场景，会引入连接状态与策略限制
- 在双路由跨网段互访里，NAT 往往会导致回程流量被丢弃或被防火墙拦截

---

### 4) PC：确认默认网关与 IP

**PC-A / PC-B（192.168.1.0/24）**

- IP：`192.168.1.x`
- 掩码：`255.255.255.0`
- 默认网关：`192.168.1.254`

**PC-C / PC-D（192.168.0.0/24）**

- IP：`192.168.0.x`
- 掩码：`255.255.255.0`
- 默认网关：`192.168.0.1`

---

## 验证与排错

### 1) 基础连通性

从 PC-A 或 PC-B（192.168.1.x）测试：

- `ping 192.168.1.100`（Router2 上行口）
- `ping 192.168.0.1`（Router2 LAN 网关）
- `ping 192.168.0.<PC-C>`、`ping 192.168.0.<PC-D>`

从 PC-C 或 PC-D（192.168.0.x）测试：

- `ping 192.168.0.1`（Router2 网关）
- `ping 192.168.1.254`（Router1 网关）
- `ping 192.168.1.<PC-A>`、`ping 192.168.1.<PC-B>`

---

### 2) 不知道 PC-C / PC-D 的 IP 怎么办？

**优先推荐：在 Router2 的 DHCP 客户端列表中查看：**

- DHCP Client List / DHCP Lease Table / 已分配地址列表

如果需要从 192.168.1.0/24 扫描 192.168.0.0/24，可选：

**使用 nmap（跨平台）：**

```bash
nmap -sn 192.168.0.0/24
```

**Windows 原生（先 ping 再看 ARP）：**

```bat
for /L %i in (1,1,254) do @ping -n 1 -w 20 192.168.0.%i > nul
arp -a
```

---

## 总结

要实现两个子网互访，核心就是两句：

1. **Router1 加静态路由：** `192.168.0.0/24 → 192.168.1.100`
2. **Router2 关闭 NAT：** 让它做纯路由转发

完成后，PC-A / PC-B / PC-C / PC-D 即可跨网段自由互访。
